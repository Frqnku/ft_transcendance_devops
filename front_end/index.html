<!doctype html>

<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BOULOT</title>
</head>

<body>
  <img class="background" src="/background.png" alt="Background Image" />
  <div class="container" id="loginContainer">
    <h2>SIGN IN</h2>
    <div class="card">
      <p> Sign in with email address</p>
      <input type="email" id="email" placeholder="Yourname@gmail.com" />
      <input type="password" id="password" placeholder="YourPassword" />
      <button id="signInBtn">Sign Up</button>
      <hr class="line" />
      <div class="google-signup">
        <p>or sign up with</p>
        <button id="googleBtn">Google</button>
        <p style="color: black;">Already a player? <a href="/front_end/src/login.html"> Log in here</a></p>
      </div>
    </div>
  </div>
  <div id="gameContainer">
    <button id="backBtn">‚Üê Back to Login</button>
    <canvas id="renderCanvas"></canvas>
    <div id="gameUI">
      <div>Player: <span id="playerScore">0</span> | AI: <span id="aiScore">0</span></div>
    </div>
    <div id="instructions">
      Use W/S or Arrow Keys to move your paddle
    </div>
  </div>

  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/5.57.1/babylon.min.js"></script>

  <script>
    document.getElementById('signInBtn').addEventListener('click', async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      if (!email || !password) {
        alert('Please fill in both email and password');
        return;
      }

      //  Test Minh
      const loginSuccessful = await simulateLogin(email, password);

      if (loginSuccessful) {
        startPongGame();
      } else {
        alert('Login failed. Please try again.');
      }
    });

    document.getElementById('backBtn').addEventListener('click', () => {
      document.getElementById('gameContainer').style.display = 'none';
      document.getElementById('loginContainer').style.display = 'flex';

      if (window.currentGame) {
        window.currentGame.dispose();
        window.currentGame = null;
      }
    });

    // Test Minh
    async function simulateLogin(email, password) {
      await new Promise(resolve => setTimeout(resolve, 1000));
      return email.includes('@') && password.length > 3;
    }

    function startPongGame() {
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('gameContainer').style.display = 'block';
      window.currentGame = new PongGame();
    }

    class PongGame {
      constructor() {
        this.canvas = document.getElementById("renderCanvas");
        this.engine = new BABYLON.Engine(this.canvas, true);

        this.playerScore = 0;
        this.aiScore = 0;
        this.ballSpeed = { x: 0.3, z: 0.2 };
        this.paddleSpeed = 0.5;

        this.inputStates = {
          wPressed: false,
          sPressed: false
        };

        this.createScene();
        this.setupControls();
        this.startGameLoop();
      }

      createScene() {
        this.scene = new BABYLON.Scene(this.engine);

        this.camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 3, 20, BABYLON.Vector3.Zero(), this.scene);
        this.camera.setTarget(BABYLON.Vector3.Zero());

        const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), this.scene);
        light.intensity = 0.8;

        this.createGameField();
        this.createBall();
        this.createPaddles();
        this.resetBall();
      }

      createGameField() {
        const fieldWidth = 16;
        const fieldHeight = 10;

        // Floor
        const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: fieldWidth, height: fieldHeight }, this.scene);
        const groundMaterial = new BABYLON.StandardMaterial("groundMat", this.scene);
        groundMaterial.diffuseColor = new BABYLON.Color3(0.1, 0.1, 0.1);
        ground.material = groundMaterial;

        // Center line
        const centerLine = BABYLON.MeshBuilder.CreateBox("centerLine", { width: 0.1, height: 0.1, depth: fieldHeight }, this.scene);
        centerLine.position = new BABYLON.Vector3(0, 0.05, 0);
        const lineMaterial = new BABYLON.StandardMaterial("lineMat", this.scene);
        lineMaterial.diffuseColor = new BABYLON.Color3(1, 1, 1);
        centerLine.material = lineMaterial;

        this.fieldWidth = fieldWidth;
        this.fieldHeight = fieldHeight;
      }

      createBall() {
        this.ball = BABYLON.MeshBuilder.CreateSphere("ball", { diameter: 0.5 }, this.scene);
        this.ball.position = new BABYLON.Vector3(0, 0.25, 0);

        const ballMaterial = new BABYLON.StandardMaterial("ballMat", this.scene);
        ballMaterial.diffuseColor = new BABYLON.Color3(1, 0, 0); // Red ball
        ballMaterial.emissiveColor = new BABYLON.Color3(0.2, 0, 0);
        this.ball.material = ballMaterial;
      }

      createPaddles() {
        // Player paddle (left)
        this.playerPaddle = BABYLON.MeshBuilder.CreateBox("playerPaddle", { width: 0.3, height: 1, depth: 2 }, this.scene);
        this.playerPaddle.position = new BABYLON.Vector3(-7, 0.5, 0);

        const playerMaterial = new BABYLON.StandardMaterial("playerMat", this.scene);
        playerMaterial.diffuseColor = new BABYLON.Color3(0, 0.8, 1);
        this.playerPaddle.material = playerMaterial;

        // AI paddle (right)
        this.aiPaddle = BABYLON.MeshBuilder.CreateBox("aiPaddle", { width: 0.3, height: 1, depth: 2 }, this.scene);
        this.aiPaddle.position = new BABYLON.Vector3(7, 0.5, 0);

        const aiMaterial = new BABYLON.StandardMaterial("aiMat", this.scene);
        aiMaterial.diffuseColor = new BABYLON.Color3(1, 0.5, 0);
        this.aiPaddle.material = aiMaterial;
      }

      setupControls() {
        window.addEventListener('keydown', (event) => {
          switch (event.code) {
            case 'KeyW':
            case 'ArrowUp':
              this.inputStates.wPressed = true;
              break;
            case 'KeyS':
            case 'ArrowDown':
              this.inputStates.sPressed = true;
              break;
          }
        });

        window.addEventListener('keyup', (event) => {
          switch (event.code) {
            case 'KeyW':
            case 'ArrowUp':
              this.inputStates.wPressed = false;
              break;
            case 'KeyS':
            case 'ArrowDown':
              this.inputStates.sPressed = false;
              break;
          }
        });
      }

      updatePlayerPaddle() {
        if (this.inputStates.wPressed && this.playerPaddle.position.z < this.fieldHeight / 2 - 1) {
          this.playerPaddle.position.z += this.paddleSpeed;
        }
        if (this.inputStates.sPressed && this.playerPaddle.position.z > -this.fieldHeight / 2 + 1) {
          this.playerPaddle.position.z -= this.paddleSpeed;
        }
      }

      updateAIPaddle() {
        const ballZ = this.ball.position.z;
        const paddleZ = this.aiPaddle.position.z;
        const aiSpeed = this.paddleSpeed * 0.8;

        if (ballZ > paddleZ + 0.5 && this.aiPaddle.position.z < this.fieldHeight / 2 - 1) {
          this.aiPaddle.position.z += aiSpeed;
        } else if (ballZ < paddleZ - 0.5 && this.aiPaddle.position.z > -this.fieldHeight / 2 + 1) {
          this.aiPaddle.position.z -= aiSpeed;
        }
      }

      updateBall() {
        this.ball.position.x += this.ballSpeed.x;
        this.ball.position.z += this.ballSpeed.z;

        // Wall collision
        if (this.ball.position.z >= this.fieldHeight / 2 - 0.25 || this.ball.position.z <= -this.fieldHeight / 2 + 0.25) {
          this.ballSpeed.z *= -1;
        }

        this.checkPaddleCollision();

        // Scoring
        if (this.ball.position.x > this.fieldWidth / 2) {
          this.playerScore++;
          this.updateScore();
          this.resetBall();
        } else if (this.ball.position.x < -this.fieldWidth / 2) {
          this.aiScore++;
          this.updateScore();
          this.resetBall();
        }
      }

      checkPaddleCollision() {
        const ballPos = this.ball.position;

        // Player paddle collision
        const playerPos = this.playerPaddle.position;
        if (ballPos.x <= playerPos.x + 0.4 && ballPos.x >= playerPos.x - 0.4 &&
          ballPos.z <= playerPos.z + 1.2 && ballPos.z >= playerPos.z - 1.2 &&
          this.ballSpeed.x < 0) {

          this.ballSpeed.x *= -1.1;
          this.ballSpeed.z += (ballPos.z - playerPos.z) * 0.1;
        }

        // AI paddle collision
        const aiPos = this.aiPaddle.position;
        if (ballPos.x >= aiPos.x - 0.4 && ballPos.x <= aiPos.x + 0.4 &&
          ballPos.z <= aiPos.z + 1.2 && ballPos.z >= aiPos.z - 1.2 &&
          this.ballSpeed.x > 0) {

          this.ballSpeed.x *= -1.1;
          this.ballSpeed.z += (ballPos.z - aiPos.z) * 0.1;
        }
      }

      resetBall() {
        this.ball.position = new BABYLON.Vector3(0, 0.25, 0);
        this.ballSpeed.x = (Math.random() > 0.5 ? 1 : -1) * 0.3;
        this.ballSpeed.z = (Math.random() - 0.5) * 0.4;
      }

      updateScore() {
        document.getElementById('playerScore').textContent = this.playerScore;
        document.getElementById('aiScore').textContent = this.aiScore;
      }

      startGameLoop() {
        this.engine.runRenderLoop(() => {
          this.updatePlayerPaddle();
          this.updateAIPaddle();
          this.updateBall();
          this.scene.render();
        });

        window.addEventListener("resize", () => {
          this.engine.resize();
        });
      }

      dispose() {
        if (this.engine) {
          this.engine.dispose();
        }
      }
    }
  </script> -->
  <script type="module" src="/src/pong.ts"></script>
</body>

</html>

<style>
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    font-family: 'Poppins', sans-serif;
  }

  .background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -1;
  }

  .container {
    margin-top: 18vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .container h2 {
    color: white;
    font-size: 5rem;
    margin-right: 20px;
  }

  .card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);

    width: 30rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    font-weight: 700;
    color: white;
  }

  .card input {
    width: 20rem;
    padding: 10px;
    margin: 10px 0;
    border: none;
    border-radius: 8px;
    background-color: rgba(38, 16, 70, 100);
    font-size: 18px;
    color: white;
  }

  #signInBtn {
    width: 21rem;
    padding: 10px;
    margin: 10px 0;
    border: none;
    border-radius: 8px;
    background: linear-gradient(90deg, #501794, #3E70A1);
    color: white;
    font-size: 15px;
    cursor: pointer;
  }

  #signInBtn:hover {
    background: linear-gradient(90deg, #5d1ba8, #4a7db5);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(80, 23, 148, 0.3);
  }

  .line {
    width: 80%;
    border: 0;
    height: 1px;
    background: rgba(19, 18, 18, 0.336);
    margin: 20px 0;
  }

  .google-signup {
    margin-top: -20px;
    font-size: small;
    font-weight: 400;
    color: darkslategrey
  }

  #googleBtn {
    width: 21rem;
    padding: 10px;
    margin: 10px 0;
    border: none;
    border-radius: 8px;
    background: linear-gradient(90deg, #501794, #3E70A1);
    color: white;
    font-size: 15px;
    cursor: pointer;
  }

  #googleBtn:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  /* Game Canvas (hidden initially) */
  #gameContainer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    display: none;
    z-index: 1000;
  }

  #renderCanvas {
    width: 100%;
    height: 100%;
    touch-action: none;
  }

  #gameUI {
    position: absolute;
    top: 20px;
    width: 100%;
    text-align: center;
    color: white;
    font-size: 24px;
    z-index: 1001;
    pointer-events: none;
  }

  #instructions {
    position: absolute;
    bottom: 20px;
    width: 100%;
    text-align: center;
    color: white;
    font-size: 16px;
    z-index: 1001;
    pointer-events: none;
  }

  #backBtn {
    position: absolute;
    top: 20px;
    left: 20px;
    padding: 10px 20px;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    z-index: 1001;
    font-family: 'Poppins', sans-serif;
  }

  #backBtn:hover {
    background: rgba(255, 255, 255, 0.3);
  }
</style>